#!/bin/sh
for file in *.org; do
    emacs $file --batch -f org-md-export-to-markdown --kill
    filename=$(basename -- "$file")
    filename="${filename%.*}"
    mdfile="$filename.md"
    mdxfile="$filename.mdx"
    echo "---" > "$mdxfile"
    awk -v RS='(\r?\n){2,}' '{print; exit}' $file | sed 's/#+//g' >> $mdxfile
    echo "---" >> "$mdxfile"
    #echo "$toc" >> "$mdxfile"
    cat "$filename.md" >> $mdxfile
    rm "$filename.md"

    emacs $file --batch -f org-latex-export-to-latex --kill
    pandoc --template eisvogel.latex -i "$filename.tex" -o "$filename.pdf"

done
